/*
soma-template - v0.2.8 - 2014-05-22
http://soundstep.github.com/soma-template/
http://www.soundstep.com
MIT licence 2014
*/
(function(p){'use strict';p.template=p.template||{};p.template.version='0.2.8';p.template.errors={TEMPLATE_STRING_NO_ELEMENT:'Error in soma.template, a string template requirement a second parameter: an element target - soma.template.create(\'string\', element)',TEMPLATE_NO_PARAM:'Error in soma.template, a template requires at least 1 parameter - soma.template.create(element)'};var q='{{';var r='}}';var s={};var t={};var u=p.template.settings=p.template.settings||{};u.autocreate=true;var w=u.tokens={start:function(a){if(isDefined(a)&&a!==''){q=escapeRegExp(a);setRegEX(a,true)}return q},end:function(a){if(isDefined(a)&&a!==''){r=escapeRegExp(a);setRegEX(a,false)}return r}};var x=u.attributes={skip:'data-skip',repeat:'data-repeat',src:'data-src',href:'data-href',show:'data-show',hide:'data-hide',cloak:'data-cloak',checked:'data-checked',disabled:'data-disabled',multiple:'data-multiple',readonly:'data-readonly',selected:'data-selected',template:'data-template',html:'data-html'};var y=u.vars={index:'$index',key:'$key',element:'$element',parentElement:'$parentElement',attribute:'$attribute',scope:'$scope'};var z=u.events={};u.eventsPrefix='data-';var A='click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup focus blur change select selectstart scroll copy cut paste mousewheel keypress error contextmenu input textinput drag dragenter dragleave dragover dragend dragstart dragover drop load submit reset search resize beforepaste beforecut beforecopy';A+=' touchstart touchend touchmove touchenter touchleave touchcancel gesturestart gesturechange gestureend';if($&&$.eventStart!==undefined){A+=' tap singletap doubletap longtap swipe swipeleft swiperight swipeup swipedown'}var B=A.split(' ');var i=-1,l=B.length;while(++i<l){z[u.eventsPrefix+B[i]]=B[i]}var C={sequence:null,token:null,expression:null,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,trim:/^[\s+]+|[\s+]+$/g,repeat:/(.*)\s+in\s+(.*)/,func:/(.*)\((.*)\)/,params:/,\s+|,|\s+,\s+/,quote:/\"|\'/g,content:/[^.|^\s]/gm,depth:/..\//g,string:/^(\"|\')(.*)(\"|\')$/};var D=(function(){if(typeof document!=='object'){return undefined}var v=3,stop=false,div=document.createElement('div');while(!stop){div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->';if(!div.getElementsByTagName('i')[0]){stop=true}}return v>4?v:undefined}());function isArray(a){return Object.prototype.toString.apply(a)==='[object Array]'}function isObject(a){return typeof a==='object'}function isString(a){return typeof a==='string'}function isElement(a){return a?a.nodeType>0:false}function isTextNode(a){return a&&a.nodeType&&a.nodeType===3}function isFunction(a){return a&&typeof a==='function'}function isDefined(a){return a!==null&&a!==undefined}function normalizeBoolean(a){if(!isDefined(a)){return false}if(a==='true'||a==='1'||a===true||a===1){return true}if(a==='false'||a==='0'||a===false||a===0||(isString(a)&&hasInterpolation(a))){return false}return!!a}function isExpression(a){return a&&isFunction(a.toString)&&a.toString()==='[object Expression]'}function isExpFunction(a){if(!isString(a)){return false}return!!a.match(C.func)}function childNodeIsTemplate(a){return a&&a.parent&&K.get(a.element)}function escapeRegExp(a){return a.replace(C.escape,'\\$&')}function setRegEX(a,b){var c=w.start().replace(/\\/g,'');var d='';var e=b?a:c;if(e.length>1){d='|\\'+e.substr(0,1)+'(?!\\'+e.substr(1,1)+')[^'+e.substr(0,1)+']*'}C.sequence=new RegExp(w.start()+'.+?'+w.end()+'|[^'+w.start()+']+'+d,'g');C.token=new RegExp(w.start()+'.*?'+w.end(),'g');C.expression=new RegExp(w.start()+'|'+w.end(),'gm')}function trim(a){return a.replace(C.trim,'')}function trimQuotes(a){if(C.string.test(a)){return a.substr(1,a.length-2)}return a}function trimArray(a){if(a[0]===''){a.shift()}if(a[a.length-1]===''){a.pop()}return a}function trimTokens(a){return a.replace(C.expression,'')}function trimScopeDepth(a){return a.replace(C.depth,'')}function insertBefore(a,b){if(!a.parentNode){return}a.parentNode.insertBefore(b,a)}function insertAfter(a,b){if(!a.parentNode){return}a.parentNode.insertBefore(b,a.nextSibling)}function removeClass(d,e){var f;if(typeof document==='object'&&document.documentElement.classList){f=function(a,b){a.classList.remove(b)}}else{f=function(a,b){if(!a||!a.className){return false}var c=new RegExp('(^|\\s)'+b+'(\\s|$)','g');a.className=a.className.replace(c,'$2')}}f(d,e)}var E=typeof document!=='object'?function(){}:document.documentElement.contains?function(a,b){var c=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&c.contains&&c.contains(bup))}:document.documentElement.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while((b=b.parentNode)){if(b===a){return true}}return false};function HashMap(c){var d={};var e=0;function uuid(){return++e+c}function getKey(a){if(!a){return}if(typeof a!=='object'){return a}var b;try{b=a[c]?a[c]:a[c]=uuid()}catch(err){}return b}this.remove=function(a){delete d[getKey(a)]};this.get=function(a){return d[getKey(a)]};this.put=function(a,b){d[getKey(a)]=b};this.has=function(a){return typeof d[getKey(a)]!=='undefined'};this.getData=function(){return d};this.dispose=function(){for(var a in d){if(d.hasOwnProperty(a)){delete d[a]}}this.length=0}}function getRepeaterData(a,b){var c=a.match(C.repeat);if(!c){return}var d=c[2];var e=new J(d);return e.getValue(b)}function updateScopeWithRepeaterData(a,b,c){var d=a.match(C.repeat);if(!d){return}var e=d[1];b[e]=c}function getWatcherValue(a,b){var c=a.node||a.attribute.node;var d=c.template.watchers;var e=c.element;if(!d){return b}var f=d.get(e);if(!f&&isTextNode(c.element)&&c.parent){f=d.get(c.parent.element)}var g=f?f:d.get(a.pattern);if(isFunction(g)){var h=g(a.value,b,a.pattern,c.scope,c,a.attribute);if(isDefined(h)){return h}}return b}function getScopeFromPattern(a,b){var c=getScopeDepth(b);var d=a;while(c>0){d=d._parent?d._parent:d;c--}return d}function getValueFromPattern(a,b,c){var d=new J(b);return getValue(a,d.pattern,d.path,d.params,undefined,undefined,undefined,c)}function getValue(a,b,c,d,e,f,g,h){if(b===y.element){return h[y.element]}if(b===y.parentElement){return h[y.parentElement]}if(b===y.attribute){return h[y.attribute]}if(b===y.scope){return h[y.scope]}if(C.string.test(b)){return trimQuotes(b)}var k=[];if(!g&&d){for(var j=0,jl=d.length;j<jl;j++){k.push(getValueFromPattern(a,d[j],h))}}else{k=g}if(f){return k}var m=getScopeFromPattern(a,b);b=b.replace(/..\//g,'');c=c.replace(/..\//g,'');if(!m){return undefined}var n=m;var o=c.split(/\.|\[|\]/g);if(o.length>0){for(var i=0,l=o.length;i<l;i++){if(o[i]!==''){n=n[o[i]]}if(!isDefined(n)){if(m._parent){return getValue(m._parent,b,c,d,e,f,k)}else{return undefined}}}}if(!isFunction(n)){return n}else{if(e){return n}else{return n.apply(null,k)}}return undefined}function getExpressionPath(a){var b=a.split('(')[0];b=trimScopeDepth(b);return b}function getParamsFromString(a){return trimArray(a.split(C.params))}function getScopeDepth(a){var b=a.split('(')[0];var c=b.match(C.depth);return!c?0:c.length}function addAttribute(a,b,c){var d;a.attributes=a.attributes||[];if(b===u.attributes.skip){a.skip=normalizeBoolean(c)}if(b===u.attributes.html){a.html=normalizeBoolean(c)}if(b===u.attributes.repeat&&!a.isRepeaterDescendant){a.repeater=c}if(hasInterpolation(b+':'+c)||b===u.attributes.repeat||b===u.attributes.skip||b===u.attributes.html||b===u.attributes.show||b===u.attributes.hide||b===u.attributes.href||b===u.attributes.checked||b===u.attributes.disabled||b===u.attributes.multiple||b===u.attributes.readonly||b===u.attributes.selected||c.indexOf(u.attributes.cloak)!==-1){d=new H(b,c,a);a.attributes.push(d)}if(z[b]){d=new H(b,c,a);a.attributes.push(d)}return d}function getNodeFromElement(c,d){var e=new G(c,d);e.previousSibling=c.previousSibling;e.nextSibling=c.nextSibling;var f=[];for(var g,attrs=c.attributes,j=0,jj=attrs&&attrs.length;j<jj;j++){g=attrs[j];if(g.specified||g.name==='value'){var h=addAttribute(e,g.name,g.value);if(z[g.name]){if(z[g.name]&&!e.isRepeaterChild){f.push({name:z[g.name],value:g.value,attr:h})}}}}for(var a=0,b=f.length;a<b;a++){e.addEvent(f[a].name,f[a].value,f[a].attr)}return e}function hasInterpolation(a){var b=a.match(C.token);return b&&b.length>0}function hasContent(a){return C.content.test(a)}function isElementValid(a){if(!a){return}var b=a.nodeType;if(!a||!b){return false}if(b===8){return false}if(b===3&&!hasContent(a.nodeValue)&&!hasInterpolation(a.nodeValue)){return false}return true}function compile(a,b,c,d){if(!isElementValid(b)){return}var e;if(!d){e=getNodeFromElement(b,c?c.scope:new F(t)._createChild())}else{e=d;e.parent=c}if(c&&(c.repeater||c.isRepeaterChild)){e.isRepeaterChild=true}e.template=a;if(e.skip){return}var f=b.firstChild;while(f){var g=compile(a,f,e);if(g){g.parent=e;e.children.push(g)}f=f.nextSibling}return e}function updateScopeWithData(a,b){clearScope(a);for(var d in b){if(b.hasOwnProperty(d)){a[d]=b[d]}}}function clearScope(a){for(var b in a){if(a.hasOwnProperty(b)){if(b.substr(0,1)!=='_'){a[b]=null;delete a[b]}}}}function updateNodeChildren(a){if(a.repeater||!a.children||childNodeIsTemplate(a)){return}for(var i=0,l=a.children.length;i<l;i++){a.children[i].update()}}function renderNodeChildren(a){if(!a.children||childNodeIsTemplate(a)){return}for(var i=0,l=a.children.length;i<l;i++){a.children[i].render()}}function renderNodeRepeater(a){var b=getRepeaterData(a.repeater,a.scope);var c;if(isArray(b)){for(var i=0,l1=b.length,l2=a.childrenRepeater.length,l=l1>l2?l1:l2;i<l;i++){if(i<l1){c=createRepeaterChild(a,i,b[i],y.index,i,c)}else{a.parent.element.removeChild(a.childrenRepeater[i].element);a.childrenRepeater[i].dispose()}}if(a.childrenRepeater.length>b.length){a.childrenRepeater.length=b.length}}else{var d=-1;for(var o in b){if(b.hasOwnProperty(o)){d++;c=createRepeaterChild(a,d,b[o],y.key,o,c)}}var e=d;while(d++<a.childrenRepeater.length-1){a.parent.element.removeChild(a.childrenRepeater[d].element);a.childrenRepeater[d].dispose()}a.childrenRepeater.length=e+1}if(a.element.parentNode){a.element.parentNode.removeChild(a.element)}}function compileClone(a,b){if(!isElementValid(b.element)){return}if(a.attributes){for(var i=0,l=a.attributes.length;i<l;i++){var c=a.attributes[i];var d=addAttribute(b,c.name,c.value);if(z[c.name]){b.addEvent(z[c.name],c.value,d)}}}var e=a.element.firstChild;var f=b.element.firstChild;var g;while(e&&f){var h=a.getNode(e);g=new G(f,b.scope);b.children.push(g);g.parent=b;g.template=b.template;g.isRepeaterChild=true;var j=compileClone(h,g);if(j){j.parent=g;j.template=g.template;g.children.push(j)}e=e.nextSibling;f=f.nextSibling}return g}function cloneRepeaterNode(a,b){var c=new G(a,b.scope._createChild());c.template=b.template;c.parent=b;c.isRepeaterChild=true;c.isRepeaterDescendant=true;compileClone(b,c);return c}function appendRepeaterElement(a,b,c){if(!a){if(b.element.previousSibling){insertAfter(b.element.previousSibling,c)}else if(b.element.nextSibling){insertBefore(b.element.nextSibling,c)}else{b.parent.element.appendChild(c)}}else{insertAfter(a,c)}}function createRepeaterChild(a,b,c,d,e,f){var g=a.childrenRepeater[b];if(!g){var h=a.element.cloneNode(true);appendRepeaterElement(f,a,h);var i=cloneRepeaterNode(h,a);a.childrenRepeater[b]=i;updateScopeWithRepeaterData(a.repeater,i.scope,c);i.scope[d]=e;i.update();i.render();return h}else{updateScopeWithRepeaterData(a.repeater,g.scope,c);g.scope[d]=e;g.update();g.render();return g.element}}var F=function(c){var d;function createChild(a){var b=createObject(a);b._parent=d;d._children.push(b);return b}function createObject(a){var b=a||{};b._parent=null;b._children=[];b._createChild=function(){d=b;return createChild.apply(b,arguments)};return b}return createObject(c)};var G=function(a,b){this.element=a;this.scope=b;this.attributes=null;this.value=null;this.interpolation=null;this.invalidate=false;this.skip=false;this.repeater=null;this.isRepeaterDescendant=false;this.isRepeaterChild=false;this.parent=null;this.children=[];this.childrenRepeater=[];this.previousSibling=null;this.nextSibling=null;this.template=null;this.eventHandlers={};this.html=false;if(isTextNode(this.element)){this.value=this.element.nodeValue;this.interpolation=new I(this.value,this,undefined)}};G.prototype={toString:function(){return'[object Node]'},dispose:function(){this.clearEvents();var i,l;if(this.children){for(i=0,l=this.children.length;i<l;i++){this.children[i].dispose()}}if(this.childrenRepeater){for(i=0,l=this.childrenRepeater.length;i<l;i++){this.childrenRepeater[i].dispose()}}if(this.attributes){for(i=0,l=this.attributes.length;i<l;i++){this.attributes[i].dispose()}}if(this.interpolation){this.interpolation.dispose()}this.element=null;this.scope=null;this.attributes=null;this.value=null;this.interpolation=null;this.repeater=null;this.parent=null;this.children=null;this.childrenRepeater=null;this.previousSibling=null;this.nextSibling=null;this.template=null;this.eventHandlers=null},getNode:function(a){var b;if(a===this.element){return this}if(this.childrenRepeater.length>0){for(var k=0,kl=this.childrenRepeater.length;k<kl;k++){b=this.childrenRepeater[k].getNode(a);if(b){return b}}}for(var i=0,l=this.children.length;i<l;i++){b=this.children[i].getNode(a);if(b){return b}}return null},getAttribute:function(a){if(this.attributes){for(var i=0,l=this.attributes.length;i<l;i++){var b=this.attributes[i];if(b.interpolationName&&b.interpolationName.value===a){return b}}}},update:function(){if(childNodeIsTemplate(this)){return}if(isDefined(this.interpolation)){this.interpolation.update()}if(isDefined(this.attributes)){for(var i=0,l=this.attributes.length;i<l;i++){this.attributes[i].update()}}updateNodeChildren(this)},invalidateData:function(){if(childNodeIsTemplate(this)){return}this.invalidate=true;var i,l;if(this.attributes){for(i=0,l=this.attributes.length;i<l;i++){this.attributes[i].invalidate=true}}for(i=0,l=this.childrenRepeater.length;i<l;i++){this.childrenRepeater[i].invalidateData()}for(i=0,l=this.children.length;i<l;i++){this.children[i].invalidateData()}},addEvent:function(e,f,g){if(this.repeater){return}if(this.eventHandlers[e]){this.removeEvent(e)}var h=this.scope;var i=this;var j=function(a){var b=new J(f,i,g);var c=b.getValue(h,true);var d=b.getValue(h,false,true);d.unshift(a);if(c){c.apply(null,d)}};this.eventHandlers[e]=j;addEvent(this.element,e,j)},removeEvent:function(a){removeEvent(this.element,a,this.eventHandlers[a]);this.eventHandlers[a]=null;delete this.eventHandlers[a]},clearEvents:function(){if(this.eventHandlers){for(var a in this.eventHandlers){if(this.eventHandlers.hasOwnProperty(a)){this.removeEvent(a)}}}if(this.children){for(var k=0,kl=this.children.length;k<kl;k++){this.children[k].clearEvents()}}if(this.childrenRepeater){for(var f=0,fl=this.childrenRepeater.length;f<fl;f++){this.childrenRepeater[f].clearEvents()}}},render:function(){if(childNodeIsTemplate(this)){return}if(this.invalidate){this.invalidate=false;if(isTextNode(this.element)){if(this.parent&&this.parent.html){this.value=this.parent.element.innerHTML=this.interpolation.render()}else{this.value=this.element.nodeValue=this.interpolation.render()}}}if(this.attributes){for(var i=0,l=this.attributes.length;i<l;i++){this.attributes[i].render()}}if(this.repeater){renderNodeRepeater(this)}else{renderNodeChildren(this)}}};var H=function(a,b,c){this.name=a;this.value=b;this.node=c;this.interpolationName=new I(this.name,null,this);this.interpolationValue=new I(this.value,null,this);this.invalidate=false};H.prototype={toString:function(){return'[object Attribute]'},dispose:function(){if(this.interpolationName){this.interpolationName.dispose()}if(this.interpolationValue){this.interpolationValue.dispose()}this.interpolationName=null;this.interpolationValue=null;this.node=null;this.name=null;this.value=null;this.previousName=null},update:function(){if(this.node.repeater){return}this.interpolationName.update();this.interpolationValue.update()},render:function(){if(this.node.repeater){return}function renderAttribute(a,b,c){if(a==='value'&&c.element['value']!==undefined){d.value=b}else if(D===7&&a==='class'){d.className=b}else{d.setAttribute(a,b)}}function renderBooleanAttribute(a,b){d.setAttribute(a,b)}function renderSpecialAttribute(a,b){if(normalizeBoolean(a)){d.setAttribute(b,b)}else{d.removeAttribute(b)}}function renderSrc(a){d.setAttribute('src',a)}function renderHref(a){d.setAttribute('href',a)}var d=this.node.element;if(this.invalidate){this.invalidate=false;this.previousName=this.name;this.name=isDefined(this.interpolationName.render())?this.interpolationName.render():this.name;this.value=isDefined(this.interpolationValue.render())?this.interpolationValue.render():this.value;if(this.name===x.src){renderSrc(this.value)}else if(this.name===x.href){renderHref(this.value)}else{if(D!==7||(D===7&&!this.node.isRepeaterChild)){this.node.element.removeAttribute(this.interpolationName.value)}if(this.previousName){if(D===7&&this.previousName==='class'){this.node.element.className=''}else{if(D!==7||(D===7&&!this.node.isRepeaterChild)){this.node.element.removeAttribute(this.previousName)}}}renderAttribute(this.name,this.value,this.node)}}if(this.name==='class'&&this.value.indexOf(u.attributes.cloak)!==-1){removeClass(this.node.element,u.attributes.cloak)}var e;if(this.name===x.hide){e=normalizeBoolean(this.value);renderAttribute(this.name,e,this.node);d.style.display=e?'none':''}if(this.name===x.show){e=normalizeBoolean(this.value);renderAttribute(this.name,e,this.node);d.style.display=e?'':'none'}if(this.name===x.checked){renderSpecialAttribute(this.value,'checked');renderAttribute(this.name,normalizeBoolean(this.value)?true:false,this.node);d.checked=normalizeBoolean(this.value)?true:false}if(this.name===x.disabled){renderSpecialAttribute(this.value,'disabled');renderAttribute(this.name,normalizeBoolean(this.value)?true:false,this.node)}if(this.name===x.multiple){renderSpecialAttribute(this.value,'multiple');renderAttribute(this.name,normalizeBoolean(this.value)?true:false,this.node)}if(this.name===x.readonly){e=normalizeBoolean(this.value);if(D===7){d.readOnly=e?true:false}else{renderSpecialAttribute(this.value,'readonly')}renderAttribute(this.name,e?true:false,this.node)}if(this.name===x.selected){renderSpecialAttribute(this.value,'selected');renderAttribute(this.name,normalizeBoolean(this.value)?true:false,this.node)}}};var I=function(a,b,c){this.value=b&&!isTextNode(b.element)?trim(a):a;this.node=b;this.attribute=c;this.sequence=[];this.expressions=[];var d=this.value.match(C.sequence);if(d){for(var i=0,l=d.length;i<l;i++){if(d[i].match(C.token)){var e=new J(trimTokens(d[i]),this.node,this.attribute);this.sequence.push(e);this.expressions.push(e)}else{this.sequence.push(d[i])}}trimArray(this.sequence)}};I.prototype={toString:function(){return'[object Interpolation]'},dispose:function(){if(this.expressions){for(var i=0,l=this.expressions.length;i<l;i++){this.expressions[i].dispose()}}this.value=null;this.node=null;this.attribute=null;this.sequence=null;this.expressions=null},update:function(){var i=-1,l=this.expressions.length;while(++i<l){this.expressions[i].update()}},render:function(){var a='';if(this.sequence){for(var i=0,l=this.sequence.length;i<l;i++){var b='';if(isExpression(this.sequence[i])){b=this.sequence[i].value}else{b=this.sequence[i]}if(!isDefined(b)){b=''}a+=b}}return a}};var J=function(a,b,c){if(!isDefined(a)){return}this.pattern=a;this.isString=C.string.test(a);this.node=b;this.attribute=c;this.value=this.isString?this.pattern:undefined;if(this.isString){this.isFunction=false;this.depth=null;this.path=null;this.params=null}else{this.isFunction=isExpFunction(this.pattern);this.depth=getScopeDepth(this.pattern);this.path=getExpressionPath(this.pattern);this.params=!this.isFunction?null:getParamsFromString(this.pattern.match(C.func)[2])}};J.prototype={toString:function(){return'[object Expression]'},dispose:function(){this.pattern=null;this.node=null;this.attribute=null;this.path=null;this.params=null;this.value=null},update:function(){var a=this.node;if(!a&&this.attribute){a=this.attribute.node}if(!a&&a.scope){return}var b=this.getValue(a.scope);b=getWatcherValue(this,b);if(this.value!==b){this.value=b;(this.node||this.attribute).invalidate=true}},getValue:function(a,b,c){var d=this.node;if(!d&&this.attribute){d=this.attribute.node}var e={};if(d){e[y.element]=d.element;if(d.element){e[y.parentElement]=d.element.parentNode}}e[y.attribute]=this.attribute;e[y.scope]=a;return getValue(a,this.pattern,this.path,this.params,b,c,undefined,e)}};var K=new HashMap('st');var L=function(a){this.watchers=new HashMap('stw');this.node=null;this.scope=null;this.compile(a)};L.prototype={toString:function(){return'[object Template]'},compile:function(a){if(a){this.element=a}if(this.node){this.node.dispose()}this.node=compile(this,this.element);this.node.root=true;this.scope=this.node.scope},update:function(a){if(isDefined(a)){updateScopeWithData(this.node.scope,a)}if(this.node){this.node.update()}},render:function(a){this.update(a);if(this.node){this.node.render()}},invalidate:function(){if(this.node){this.node.invalidateData()}},watch:function(a,b){if((!isString(a)&&!isElement(a))||!isFunction(b)){return}this.watchers.put(a,b)},unwatch:function(a){this.watchers.remove(a)},clearWatchers:function(){this.watchers.dispose()},clearEvents:function(){this.node.clearEvents()},getNode:function(a){return this.node.getNode(a)},dispose:function(){K.remove(this.element);if(this.watchers){this.watchers.dispose()}if(this.node){this.node.dispose()}this.element=null;this.watchers=null;this.node=null}};function addEvent(d,e,f){if(d.addEventListener){if(window&&window.jQuery||window.$chocolatechip){$(d).on(e,f)}else{d.addEventListener(e,f,false)}}else{if(!f.$$guid){f.$$guid=addEvent.guid++}if(!d.events){d.events={}}var g=d.events[e];if(!g){g=d.events[e]={};if(d['on'+e]){g[0]=d['on'+e]}}g[f.$$guid]=f;d['on'+e]=function(a){var b=true;a=a||fixEvent(((this.ownerDocument||this.document||this).parentWindow||window).event);var c=this.events[a.type];for(var i in c){if(c.hasOwnProperty(i)){this.$$handleEvent=c[i];if(this.$$handleEvent(a)===false){b=false}}}return b}}}addEvent.guid=1;function removeEvent(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}else{if(a.events&&a.events[b]){delete a.events[b][c.$$guid]}}}function fixEvent(a){a.preventDefault=fixEvent.preventDefault;a.stopPropagation=fixEvent.stopPropagation;return a}fixEvent.preventDefault=function(){this.returnValue=false};fixEvent.stopPropagation=function(){this.cancelBubble=true};var M;var N=[];function parseEvents(a,b,c){M=c===undefined?Number.MAX_VALUE:c;parseNode(a,b,0,true)}function parseNode(a,b,c,d){if(!isElement(a)){throw new Error('Error in soma.template.parseEvents, only a DOM Element can be parsed.');}if(d){parseAttributes(a,b)}if(M===0){return}var e=a.firstChild;while(e){if(e.nodeType===1){if(c<M){parseNode(e,b,++c);parseAttributes(e,b)}}e=e.nextSibling}}function parseAttributes(a,b){for(var c,name,value,attrs=a.attributes,j=0,jj=attrs&&attrs.length;j<jj;j++){c=attrs[j];if(c.specified){name=c.name;value=c.value;if(z[name]){var d=getHandlerFromPattern(b,value);if(d&&isFunction(d)){addEvent(a,z[name],d);N.push({element:a,type:z[name],handler:d})}}}}}function getHandlerFromPattern(a,b){var c=b.match(C.func);if(c){var d=c[1];if(isFunction(a[d])){return a[d]}}}function clearEvents(a){var i=N.length,l=0;while(--i>=l){var b=N[i];if(a===b.element||E(a,b.element)){removeEvent(b.element,b.type,b.handler);N.splice(i,1)}}}var O;if(typeof document==='object'){var O=function(){function l(b){for(k=1;b=a.shift();)b()}var b,a=[],c=!1,d=document,e=d.documentElement,f=e.doScroll,g="DOMContentLoaded",h="addEventListener",i="onreadystatechange",j="readyState",k=/^loade|c/.test(d[j]);return d[h]&&d[h](g,b=function(){d.removeEventListener(g,b,c),l()},c),f&&d.attachEvent(i,b=function(){/^c/.test(d[j])&&(d.detachEvent(i,b),l())}),f?function(b){self!=top?k?b():a.push(b):function(){try{e.doScroll("left")}catch(a){return setTimeout(function(){O(b)},50)}b()}()}:function(b){k?b():a.push(b)}}();if(u.autocreate){var P=function(a){var b=!a?document.body:a.firstChild;while(b){if(b.nodeType===1){P(b);var c=b.getAttribute(x.template);if(c){var d=new Function('return '+c+';');try{var f=d();if(isFunction(f)){p.template.bootstrap(c,b,f)}}catch(err){}}}b=b.nextSibling}};O(P)}}function bootstrapTemplate(a,b,c){var d=createTemplate(b);c(d,d.scope,d.element,d.node)}function createTemplate(a,b){var c;if(isString(a)){if(!isElement(b)){throw new Error(p.template.errors.TEMPLATE_STRING_NO_ELEMENT);}b.innerHTML=a;c=b}else if(isElement(a)){if(isElement(b)){b.innerHTML=a.innerHTML;c=b}else{c=a}}else{throw new Error(p.template.errors.TEMPLATE_NO_PARAM);}if(getTemplate(c)){getTemplate(c).dispose();K.remove(c)}var d=new L(c);K.put(c,d);return d}function getTemplate(a){return K.get(a)}function renderAllTemplates(){var a=K.getData();for(var b in K.getData()){if(a.hasOwnProperty(b)){K.get(b).render()}}}function appendHelpers(a){if(a===null){s={};t={}}if(isDefined(a)&&isObject(a)){for(var b in a){if(a.hasOwnProperty(b)){s[b]=t[b]=a[b]}}}return s}w.start(q);w.end(r);p.plugins=p.plugins||{};var Q=function(f,g){f.constructor.prototype.createTemplate=function(a,b){if(!a||typeof a!=='function'){throw new Error('Error creating a template, the first parameter must be a function.');}if(b&&isElement(b)){var c=p.template.create(b);for(var d in c){if(typeof c[d]==='function'){a.prototype[d]=c[d].bind(c)}}a.prototype.render=c.render.bind(c);var e=g.createChild();e.mapValue('template',c);e.mapValue('scope',c.scope);e.mapValue('element',c.element);return e.createInstance(a)}return null};p.template.bootstrap=function(a,b,c){f.createTemplate(c,b)}};if(p.plugins&&p.plugins.add){p.plugins.add(Q)}p.template.Plugin=Q;p.template.create=createTemplate;p.template.get=getTemplate;p.template.renderAll=renderAllTemplates;p.template.helpers=appendHelpers;p.template.bootstrap=bootstrapTemplate;p.template.addEvent=addEvent;p.template.removeEvent=removeEvent;p.template.parseEvents=parseEvents;p.template.clearEvents=clearEvents;p.template.ready=O;if(typeof define==='function'&&typeof define.amd!=='undefined'){define('soma-template',p.template)}if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=p.template}if(typeof exports!=='undefined'){exports=p.template}})(this['soma']=this['soma']||{});